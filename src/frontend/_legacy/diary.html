<!DOCTYPE html>
<html lang="cs">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Deník - Rezervace chaty</title>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <!-- Google Fonts pro rukopisný styl -->
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&display=swap" rel="stylesheet" />
  </head>
  <body>
    <div class="app-wrapper">
      <div id="app-container" class="app-container hidden">
        <div class="top-bar">
          <nav class="app-nav">
            <a href="index.html" class="nav-link">Rezervace</a>
            <a href="notes.html" class="nav-link">Nástěnka</a>
            <a href="gallery.html" class="nav-link">Galerie</a>
            <a href="diary.html" class="nav-link active">Deník</a>
            <a href="reconstruction.html" class="nav-link">Rekonstrukce</a>
          </nav>
          <div class="user-info">
            <span class="username-display">Přihlášen jako: <strong id="logged-in-username"></strong></span>
            <button id="logout-button" class="button-logout"><i class="fas fa-sign-out-alt"></i> Odhlásit se</button>
          </div>
        </div>

        <!-- HLAVNÍ OBSAH -->
        <div class="main-content-diary">
          <div class="card diary-card">
            <!-- 1. POHLED: SEZNAM DENÍKŮ -->
            <div id="diary-folders-view" style="display: flex; flex-direction: column; height: 100%">
              <div class="diary-header">
                <h2><i class="fas fa-book-open"></i> Deníky výletů</h2>
              </div>

              <div class="diary-content-wrapper">
                <div id="diary-folders-grid" class="folders-grid">
                  <!-- Zde se načtou složky/deníky -->
                </div>
              </div>

              <div class="diary-footer">
                <div class="footer-left" id="diary-folder-actions-group">
                  <button id="rename-diary-folder-list-btn" class="gallery-btn gallery-btn-secondary" style="display: none"><i class="fas fa-edit"></i> Přejmenovat</button>
                  <button id="delete-diary-folder-list-btn" class="gallery-btn gallery-btn-danger" style="display: none"><i class="fas fa-trash-alt"></i> Smazat deník</button>
                </div>
                <div class="footer-right">
                  <button id="create-diary-folder-btn" class="gallery-btn gallery-btn-primary"><i class="fas fa-plus"></i> Nový deník</button>
                </div>
              </div>
            </div>

            <!-- 2. POHLED: ZÁPISY (UVNITŘ DENÍKU) -->
            <div id="diary-entries-view" style="display: none; flex-direction: column; height: 100%">
              <div class="diary-header">
                <h2 id="current-diary-title">Název deníku</h2>
              </div>

              <div class="diary-content-wrapper diary-calendar-wrapper">
                <div id="diary-calendar" class="diary-calendar"></div>
              </div>

              <div class="diary-footer">
                <div class="footer-left">
                  <button id="back-to-diary-folders-btn" class="gallery-btn gallery-btn-secondary">Zpět</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Login Container -->
      <div id="auth-container" class="login-container card hidden">
        <h2>Přihlášení</h2>
        <p>Pro zobrazení deníku se prosím <a href="index.html">přihlaste</a>.</p>
      </div>
    </div>

    <!-- MODAL: VYTVOŘIT NOVÝ DENÍK -->
    <div id="create-diary-folder-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <span class="modal-close-button">&times;</span>
        <h2>Nový deník</h2>
        <form id="create-diary-folder-form">
          <div class="form-group">
            <label for="diary-folder-name-input">Název deníku (např. Letní prázdniny):</label>
            <input type="text" id="diary-folder-name-input" required placeholder="Zadejte název..." />
          </div>
          <div class="form-group" style="display: flex; gap: 10px">
            <div style="flex: 1">
              <label for="diary-start-date">Od:</label>
              <input type="date" id="diary-start-date" required />
            </div>
            <div style="flex: 1">
              <label for="diary-end-date">Do:</label>
              <input type="date" id="diary-end-date" required />
            </div>
          </div>
          <div class="modal-buttons">
            <button type="submit" class="gallery-btn gallery-btn-primary" style="width: 100%">Vytvořit</button>
          </div>
        </form>
      </div>
    </div>

    <!-- MODAL: PŘEJMENOVAT DENÍK -->
    <div id="rename-diary-folder-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <span class="modal-close-button">&times;</span>
        <h2>Přejmenovat deník</h2>
        <p>Původní název: <strong id="old-diary-folder-name"></strong></p>
        <form id="rename-diary-folder-form">
          <div class="form-group">
            <label for="new-diary-folder-name-input">Nový název:</label>
            <input type="text" id="new-diary-folder-name-input" required minlength="1" maxlength="50" />
          </div>
          <div class="modal-buttons">
            <button type="submit" class="gallery-btn gallery-btn-primary" style="width: 100%">Uložit</button>
          </div>
        </form>
      </div>
    </div>

    <!-- MODAL: DELETE FOLDER WARNING -->
    <div id="delete-diary-folder-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <span class="modal-close-button">&times;</span>
        <h2 style="color: #ef4444"><i class="fas fa-exclamation-triangle"></i> Varování</h2>
        <p>Tento deník obsahuje zápisky. Pokud ho smažete, <strong>všechny vzpomínky v něm budou nenávratně ztraceny</strong>.</p>
        <p>Pro potvrzení smazání napište do pole níže slovo <strong>DELETE</strong>.</p>

        <form id="delete-diary-folder-form">
          <div class="form-group">
            <input type="text" id="delete-diary-confirm-input" placeholder="DELETE" class="input-danger" required />
          </div>
          <div class="modal-buttons">
            <button type="submit" class="gallery-btn gallery-btn-danger" style="width: 100%">Potvrdit smazání</button>
          </div>
        </form>
      </div>
    </div>

    <!-- MODAL: NOTEBOOK (EDITACE ZÁPISU) -->
    <div id="notebook-modal" class="modal-overlay" style="display: none">
      <div class="notebook-modal-content">
        <div class="notebook-paper">
          <div class="notebook-holes"></div>
          <div class="notebook-header">
            <span id="notebook-date-display">Datum</span>
            <span class="notebook-close-button">&times;</span>
          </div>
          <div class="notebook-body">
            <textarea id="notebook-textarea" placeholder="Milý deníčku..."></textarea>

            <!-- Zóna pro připojené fotky -->
            <div id="notebook-attachments-area" class="notebook-attachments">
              <!-- Zde se zobrazí miniatury fotek -->
            </div>
          </div>
          <div class="notebook-footer">
            <!-- Tlačítko pro přidání fotky z galerie -->
            <button id="attach-photo-btn" class="notebook-btn-attach"><i class="fas fa-images"></i> Připojit fotku</button>

            <button id="save-notebook-entry-btn" class="notebook-btn-save"><i class="fas fa-save"></i> Uložit</button>
            <button id="delete-notebook-entry-btn" class="notebook-btn-delete" style="display: none"><i class="fas fa-trash"></i> Vytrhnout</button>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL: VÝBĚR FOTEK Z GALERIE -->
    <div id="select-gallery-photo-modal" class="modal-overlay" style="display: none; z-index: 1100">
      <div class="modal-content" style="max-width: 800px; height: 80vh; display: flex; flex-direction: column">
        <span class="modal-close-button">&times;</span>
        <h2>Vyberte fotky z galerie</h2>

        <div id="gallery-picker-content" style="flex-grow: 1; overflow-y: auto; padding: 10px; border: 1px solid #eee; border-radius: 8px">
          <!-- Zde se dynamicky načtou složky nebo fotky -->
          <div id="gallery-picker-folders" class="folders-grid" style="grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px"></div>
          <div id="gallery-picker-photos" class="photos-grid" style="display: none; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 5px"></div>
        </div>

        <div class="modal-buttons" style="margin-top: 15px; justify-content: space-between">
          <button id="gallery-picker-back-btn" class="gallery-btn gallery-btn-secondary" style="display: none"><i class="fas fa-arrow-left"></i> Zpět na alba</button>
          <button id="gallery-picker-confirm-btn" class="gallery-btn gallery-btn-primary">Použít vybrané</button>
        </div>
      </div>
    </div>

    <!-- LIGHTBOX (DETAIL FOTKY) - PŘIDÁNO PRO DENÍK -->
    <div id="lightbox-modal" class="lightbox-overlay" style="display: none">
      <button id="lightbox-close" class="lightbox-close">&times;</button>
      <div class="lightbox-content">
        <img id="lightbox-img" src="" alt="Detail fotky" />

        <!-- Popisek (pouze pro čtení v deníku, nebo skryjeme) -->
        <div class="lightbox-caption-container">
          <p id="lightbox-description" class="lightbox-description"></p>
        </div>

        <div class="lightbox-controls">
          <!-- V deníku stačí asi jen zavřít, nebo stáhnout -->
          <a id="lightbox-download" href="#" download class="lightbox-btn"> <i class="fas fa-download"></i> Stáhnout </a>
        </div>
      </div>
      <button id="lightbox-prev" class="lightbox-arrow left"><i class="fas fa-chevron-left"></i></button>
      <button id="lightbox-next" class="lightbox-arrow right"><i class="fas fa-chevron-right"></i></button>
    </div>

    <!-- SUCCESS TOAST -->
    <div id="success-toast" class="toast">
      <i class="fas fa-check-circle"></i>
      <span>Akce provedena úspěšně.</span>
    </div>

    <script src="common.js"></script>
    <script src="diary.js"></script>
  </body>
</html>
